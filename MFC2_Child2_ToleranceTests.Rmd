---
title: "Child Doc 2: OGTT & ITT Data"
author: "Grace Rubin"
date: "`r Sys.Date()`"
output: html_document
---

<!-- This is the child document containing data visualizations and statistical analyses for MFC2 OGTT and ITT Data -->

```{r setup child doc 2, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  warning = FALSE, 
  message = FALSE, 
  collapse = TRUE,
  fig.height = 3, 
  fig.width = 4, 
  fig.align = 'center'
)

# loading packages
library(ggpubr)
library(nlme)
library(tidyverse)
library(here)
library(knitr)
library(DT)
library(lme4)
library(lmerTest) 
```

```{r Reading data child doc 2, include=FALSE}
# Loading OGTT data
OGTT_long <- read.csv("HEB114_OGTTs_Long.csv")
    # some data cleaning
      head(OGTT_long) # checking out the data frame 
      class(OGTT_long$Day) # what class is "Day"?
      OGTT_long$Day <- factor(OGTT_long$Day, levels = c("D-2", "D6")) # changing to ordered factor
      class(OGTT_long$Mouse) 
      OGTT_long$Mouse <- as.character(OGTT_long$Mouse) 

# Loading ITT data
ITT_long <- read.csv("HEB114_ITTs_Long.csv")
    # some data cleaning
     head(ITT_long) # checking out the data frame 
     class(ITT_long$Day) # what class is "Day"?
     ITT_long$Day <- factor(ITT_long$Day, levels = c("D-1", "D7")) # changing to ordered factor
     class(ITT_long$Mouse) # what class is "Mouse"?
     ITT_long$Mouse <- as.character(ITT_long$Mouse) # changing mouse to character
     ITT_long <- ITT_long %>% 
       select(Date:Blood_glucose)
     
# Loading metadata 
Metadata <- read.csv("HEB114_Metadata.csv") 
Metadata$Mouse <- as.character(Metadata$Mouse) # changing mouse to character

# Merge with OGTT
OGTT_long <- left_join(OGTT_long, Metadata, by = "Mouse")

# Merge with ITT
ITT_long <- left_join(ITT_long, Metadata, by = "Mouse")

# color scheme 
c2 = scale_color_manual(values = c(
  "ABX" = "cornflowerblue", 
  "Non_ABX" = "palevioletred"))

f2 = scale_fill_manual(values = c(
  "ABX" = "cornflowerblue", 
  "Non_ABX" = "palevioletred"))
```

## 2.a. Overview

- Each mouse received an OGTT and an ITT at baseline and endpoint. Therefore, we can assess the effects of hormone treatment via:
  + Intragroup / intramouse longitudinal changes from baseline to endpoint
  + Cross-sectional differences between groups at endpoint 

- Useful group comparisons:
  + We can compare metabolic test results in hormone-exposed mice with results in saline-exposed mice within the *same microbiome condition* (Non-ABX or ABX) to quantify the metabolic effects of each hormone under a given gut microbiome environment. 
  + We can compare metabolic test results in mice exposed to the same hormone but under *different microbiome conditions* to isolate any additive or interaction effects of hormones and gut microbiome presence on glucose homeostasis. 
  
- For each test, we can look at: 
  + The response over time (typical curve) in absolute numbers
  + Area under the curve (AUC)
  + The response over time as a % change from the fasting BG
      + *In the literature, this is more commonly shown for ITTs than OGTTs*
  + Fasting blood glucose from both tests (2 baseline and 2 endpoint measurements per mouse)
  
Here's a simple review of the difference between what OGTTs and ITTs tell us:

- **OGTT**: Measures how efficiently an organism processes glucose, assessing glucose tolerance and the overall function of glucose regulatory mechanisms. A mouse's response to an OGTT depends on both the ability of the pancreas to secrete insulin in response to glucose and the effectiveness of tissues (e.g., muscle, liver, adipose tissue) in taking up glucose out of circulation. Poor glucose processing during an OGTT suggests **glucose intolerance.**

- **ITT**: Measures how effectively insulin lowers blood glucose levels (i.e. the sensitivity / responsiveness of tissues to insulin). Reduced glucose clearance during an ITT suggests **insulin resistance**. Together, OGTTs and ITTs provide us with a complementary look at glucose homeostasis.

- **AUC** is a quantitative measure of the total blood glucose exposure over time during an OGTT or ITT. It is calculated by summing the area under the glucose curve generated by plotting glucose levels against time (i.e. integration). AUC allows for easy comparison between groups or treatments by summarizing complex time-series data into a single, interpretable metric.

NOTES: 

- Two glucose measurements were taken for each mouse at each time point. If the 2 measurements were >25 apart, a 3rd measurement was taken. Mean blood glucose (of the 2-3 measurements) was calculated. Measurements >1 SD away from the mean were removed, and the mean was re-calculated.

- While OGTTs have a nearly 100% successful execution rate, ITTs occasionally are unsuccessful (likely due to human error in injection). For this experiment, I set a cutoff for a successful ITT as a >15% drop in blood glucose levels from fasting (time 0) to time 15. Data from tests that failed to meet this threshold were not included in the final data files. Unfortunately, this means that some mice do not have both baseline and endpoint ITT measurements.

## 2.a.i. OGTT and ITTs at baseline

While less relevant to the hypotheses of this project, it's notable that there are differences between responses to the tolerance tests in abx and non-abx mice prior to any hormone injections (at baseline). 

### Absolute Responses

Here are two visualizations of those baseline differences. The first shows the mean response with standard error bars, and the second shows each individual mouse's response with the group means overlaid: 
```{r OGTTs baseline absolute}

# Filtering to just baseline
OGTT_baseline_data <- OGTT_long %>% 
  filter(Day == "D-2") 

Baseline_OGTT_by_abx <- ggplot(OGTT_baseline_data, 
  aes(x = Time_min, y = Blood_glucose, color = ABX, group = ABX)) + # grouping by ABX
  stat_summary(fun = "mean", geom = "point") + # adding mean points
  stat_summary(fun = "mean", geom = "line") + # adding mean line
  stat_summary(geom = "linerange") + # adding standard error bars
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline Oral Glucose Tolerance Tests", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_OGTT_by_abx # plotting

# We could alternatively visualize both means and the test response for each mouse
Baseline_OGTT_by_abx2 <- ggplot(OGTT_baseline_data, 
  aes(x = Time_min, y = Blood_glucose, color = ABX, group = Mouse)) + # change group to mouse
  geom_line(alpha = 0.3) + # adding transparency to indiv mouse lines 
  stat_summary(aes(group = ABX), fun = "mean", geom = "point", size = 2) +
  stat_summary(aes(group = ABX), fun = "mean", geom = "line", linewidth = 1) +  # mean per abx group
  stat_summary(geom = "linerange") +
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline Oral Glucose Tolerance Tests", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_OGTT_by_abx2

```

Below is the same two visualization styles, but for ITT responses:
```{r ITTs baseline absolute}

# Filtering to just baseline
ITT_baseline_data <- ITT_long %>% 
  filter(Day == "D-1") 

Baseline_ITT_by_abx <- ggplot(ITT_baseline_data, 
  aes(x = Time_min, y = Blood_glucose, color = ABX, group = ABX)) + # grouping by ABX
  stat_summary(fun = "mean", geom = "point") + # adding mean points
  stat_summary(fun = "mean", geom = "line") + # adding mean line
  stat_summary(geom = "linerange") + # adding standard error bars
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline Insulin Tolerance Tests", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_ITT_by_abx # plotting

# We could alternatively visualize both means and the test response for each mouse
Baseline_ITT_by_abx2 <- ggplot(ITT_baseline_data, 
  aes(x = Time_min, y = Blood_glucose, color = ABX, group = Mouse)) + # change group to mouse
  geom_line(alpha = 0.3) + # adding transparency to indiv mouse lines 
  stat_summary(aes(group = ABX), fun = "mean", geom = "point", size = 2) +
  stat_summary(aes(group = ABX), fun = "mean", geom = "line", linewidth = 1) +  # mean per abx group
  stat_summary(geom = "linerange") +
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline Insulin Tolerance Tests", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_ITT_by_abx2

```

### AUC
Now let's look at the AUCs for the baseline OGTT and ITTs in ABX and Non-ABX mice:

```{r AUC Calculation Data Prep}
# Making a function for the trapezoid integration method
calculate_auc <- function(df) {
    # Ensure the time points are in the correct order
    time_points <- c(0, 15, 30, 60, 90, 120)
        
    # Extract glucose values
    glucose_values <- df %>% select(starts_with("Time_")) %>% as.numeric()
        
    # Calculate AUC 
    auc <- sum(diff(time_points) * (glucose_values[-length(glucose_values)] + glucose_values[-1]) / 2)
        
        return(auc) # return AUC
}

# To implement I need to convert my DFs to wide format:
# OGTT
OGTTs_wide <- OGTT_long %>%
        pivot_wider(names_from = Time_min, values_from = Blood_glucose, names_prefix = "Time_")
 
# ITT
ITTs_wide <- ITT_long %>%
        pivot_wider(names_from = Time_min, values_from = Blood_glucose, names_prefix = "Time_")

# Now apply the calculate_auc() function to each row
      # OGTTs
      OGTTs_wide <- OGTTs_wide %>%
        rowwise() %>%
        mutate(AUC = calculate_auc(cur_data()))
      
      # ITTs
      ITTs_wide <- ITTs_wide %>%
        rowwise() %>%
        mutate(AUC = calculate_auc(cur_data()))
      
# plus some more pretty colors
c4 = scale_fill_manual(values = c("cyan1", "orange","darkorchid1", "springgreen")) # pretty colors!
```

```{r OGTTs baseline absolute AUC}
# AUC is typically plotted as a bar graph of means and SEs. To create these plots, we first will need to calculate AUC summary statistics. I'll do it for all days and separately for just baseline:
AUC_summary_stats_OGTT <- OGTTs_wide %>%
        group_by(ABX, Hormone, Day) %>%
        summarize(
          mean_AUC = mean(AUC, na.rm = TRUE),
          sd_AUC = sd(AUC, na.rm = TRUE),
          se_AUC = sd(AUC, na.rm = TRUE) / sqrt(n()),
          ymin = mean_AUC - se_AUC,
          ymax = mean_AUC + se_AUC
        ) # all days and groups

AUC_summary_stats_OGTT_baseline <- OGTTs_wide %>% 
  filter(Day == "D-2") %>%  group_by(ABX) %>%
        summarize(
          mean_AUC = mean(AUC, na.rm = TRUE),
          sd_AUC = sd(AUC, na.rm = TRUE),
          se_AUC = sd(AUC, na.rm = TRUE) / sqrt(n()),
          ymin = mean_AUC - se_AUC,
          ymax = mean_AUC + se_AUC) # just baseline abx vs non abx

AUC_bar_graph_baseline_OGTT <- AUC_summary_stats_OGTT_baseline %>% 
        ggplot(aes(x = ABX, y = mean_AUC, fill = ABX)) +
        geom_bar(stat = "identity", position = "dodge") +
        f2 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Baseline OGTT AUCs",
          x = "Antibiotic Status",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_baseline_OGTT
```

Is there a significant difference at baseline between ABX and non-ABX OGTT AUCs? 
```{r Stats testing 1}
# filter data
ttest_data_1 <- OGTTs_wide %>% 
     filter(Day == "D-2") # filtering data 

# unpaired t-test
ttest_result_1 <- t.test(AUC ~ ABX, data = ttest_data_1, paired = FALSE) 

# Making a function that prints a summary of my results of interest from t-tests
analyze_ttest <- function(ttest_result) {
  # Extract p-value
  p_value <- ttest_result$p.value
  
  # Determine significance
  significance <- ifelse(p_value < 0.05, "significant.", "not significant.")
  
  # Print the result
  return(paste("The t-test result is", significance,
               "p =", signif(p_value, 3), "."))
}

analyze_ttest(ttest_result_1)
```

```{r ITTs baseline absolute AUC}
# Summary stats calculation
AUC_summary_stats_ITT <- ITTs_wide %>%
        group_by(ABX, Hormone, Day) %>%
        summarize(
          mean_AUC = mean(AUC, na.rm = TRUE),
          sd_AUC = sd(AUC, na.rm = TRUE),
          se_AUC = sd(AUC, na.rm = TRUE) / sqrt(n()),
          ymin = mean_AUC - se_AUC,
          ymax = mean_AUC + se_AUC
        ) # all days and groups

AUC_summary_stats_ITT_baseline <- ITTs_wide %>% 
  filter(Day == "D-1") %>%  group_by(ABX) %>%
        summarize(
          mean_AUC = mean(AUC, na.rm = TRUE),
          sd_AUC = sd(AUC, na.rm = TRUE),
          se_AUC = sd(AUC, na.rm = TRUE) / sqrt(n()),
          ymin = mean_AUC - se_AUC,
          ymax = mean_AUC + se_AUC) # just baseline abx vs non abx

AUC_bar_graph_baseline_ITT <- AUC_summary_stats_ITT_baseline %>% 
        ggplot(aes(x = ABX, y = mean_AUC, fill = ABX)) +
        geom_bar(stat = "identity", position = "dodge") +
        f2 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Baseline ITT AUCs",
          x = "Antibiotic Status",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_baseline_ITT
```

Is there a significant difference at baseline between ABX and non-ABX ITT AUCs? 

```{r Stats testing 2}
# filter data
ttest_data_2 <- ITTs_wide %>% 
     filter(Day == "D-1") # filtering data 

# unpaired t-test
ttest_result_2 <- t.test(AUC ~ ABX, data = ttest_data_2, paired = FALSE) 

analyze_ttest(ttest_result_2)
```

*Key takeaway:* We are observing discordance between the OGTT and ITT data. The OGTT data shows greater glucose tolerance (indicating lower insulin resistance) in the *ABX* mice (as expected), while in the ITT data, the *Non-ABX* mice exhibit greater glucose drops (potentially indicating lower insulin resistance). This apparent contradiction may be resolved by looking at both in terms of % change in addition to absolute change:

### Percent Change Responses
```{r OGTTs baseline percentage}
# Making new DF with % included
OGTT_percentage <- OGTT_long %>%
        group_by(Mouse, Day) %>%
        mutate(BG_percent_of_baseline = (Blood_glucose / Blood_glucose[Time_min == 0]) * 100)

OGTT_percentage_baseline_data <- OGTT_percentage %>% 
  filter(Day == "D-2") 

# Visualization by group mean
Baseline_OGTT_by_abx_perc <- ggplot(OGTT_percentage_baseline_data, 
  aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = ABX)) + # grouping by ABX
  stat_summary(fun = "mean", geom = "point") + # adding mean points
  stat_summary(fun = "mean", geom = "line") + # adding mean line
  stat_summary(geom = "linerange") + # adding standard error bars
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline OGTTs (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_OGTT_by_abx_perc # plotting

# We could alternatively visualize both means and the test response for each mouse
Baseline_OGTT_by_abx_perc2 <- ggplot(OGTT_percentage_baseline_data, 
  aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = Mouse)) + # change group to mouse
  geom_line(alpha = 0.3) + # adding transparency to indiv mouse lines 
  stat_summary(aes(group = ABX), fun = "mean", geom = "point", size = 2) +
  stat_summary(aes(group = ABX), fun = "mean", geom = "line", linewidth = 1) +  # mean per abx group
  stat_summary(geom = "linerange") +
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline OGTTs (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_OGTT_by_abx_perc2

```

```{r ITTs baseline percentage}
# Making new DF with % included
ITT_percentage <- ITT_long %>%
        group_by(Mouse, Day) %>%
        mutate(BG_percent_of_baseline = (Blood_glucose / Blood_glucose[Time_min == 0]) * 100)

ITT_percentage_baseline_data <- ITT_percentage %>% 
  filter(Day == "D-1") 

# Visualization by group mean
Baseline_ITT_by_abx_perc <- ggplot(ITT_percentage_baseline_data, 
  aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = ABX)) + # grouping by ABX
  stat_summary(fun = "mean", geom = "point") + # adding mean points
  stat_summary(fun = "mean", geom = "line") + # adding mean line
  stat_summary(geom = "linerange") + # adding standard error bars
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline ITTs (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_ITT_by_abx_perc # plotting

# We could alternatively visualize both means and the test response for each mouse
Baseline_ITT_by_abx_perc2 <- ggplot(ITT_percentage_baseline_data, 
  aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = Mouse)) + # change group to mouse
  geom_line(alpha = 0.3) + # adding transparency to indiv mouse lines 
  stat_summary(aes(group = ABX), fun = "mean", geom = "point", size = 2) +
  stat_summary(aes(group = ABX), fun = "mean", geom = "line", linewidth = 1) +  # mean per abx group
  stat_summary(geom = "linerange") +
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "Baseline ITTs (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Antibiotic Group") +
  theme_bw() + c2
Baseline_ITT_by_abx_perc2

```

NOTE: I'm unsure if it would make sense to calculate AUCs for the %-based graphs. There's certainly an argument for it, but I don't think I've ever seen it. 

### Fasting BG

In both tests, there is a clear pattern of lower fasting BG in ABX mice. This aligns with our previous findings. We can combine the fasting BG levels at both tests (since both are baselines, just a day apart), and run an LME to test the significance of these fasting differences. 

```{r Fasting BG baseline LME}
# First need to make a Fasting BG data frame
# Filter rows where Time_min == "0" in each data frame
OGTT_filtered <- OGTT_long %>% filter(Time_min == "0")
ITT_filtered <- ITT_long %>% filter(Time_min == "0")

# Combine the filtered rows into a new data frame
Fasting_BG <- bind_rows(OGTT_filtered, ITT_filtered)

# Now need to filter my data to just be the D-1 and D-2 days
Fasting_BG_baseline <- Fasting_BG %>% 
  filter(Day == "D-2" | Day == "D-1")

# Running the LME
fasting_bg_baseline_lme_model <- lmer(Blood_glucose ~ ABX + (1 | Mouse), data = Fasting_BG_baseline)
fasting_bg_baseline_lme_model_summary <- summary(fasting_bg_baseline_lme_model)

# Writing a function that extracts the p value from this simple type of LME (that is basically a t-test with a random effect):
analyze_lme <- function(lme_summary) {
  # Extract the p-value for the fixed effect (assumes ABX is the second fixed effect)
  p_value <- lme_summary$coefficients[2, "Pr(>|t|)"]
  
  # Determine significance
  significance <- ifelse(p_value < 0.05, "significant.", "not significant.")
  
  # Print the result
  return(paste("The linear mixed-effects model shows that the effect is", significance,
               "p =", signif(p_value, 3), "."))
}

# running the function!
analyze_lme(fasting_bg_baseline_lme_model_summary)
```
As expected, there is a significant effect of ABX-status on fasting blood glucose levels (p = 0.00002). 

## 2.a.ii. Longitudinal changes in OGTTs and ITTs in each group

### Absolute Response Over Time
  
OGTTs Each hormone longitudinally in mice with a conventional gut microbiome: 
```{r OGTTs Non-ABX Longitudinal Absolute, fig.width = 5}
# Filtering to just non abx mice
NonABX_OGTT_data <- OGTT_long %>% 
  filter(ABX == "Non_ABX")

# choosing new fun colors
cb = scale_color_manual(values = c("plum3", "aquamarine3"))
fb = scale_fill_manual(values = c("plum3", "aquamarine3"))

OGTT_longitudinal_nonabx <- ggplot(NonABX_OGTT_data, 
              aes(x = Time_min, y = Blood_glucose, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs Longitudinally \n in Non-ABX Mice", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Day") +
  theme_bw() + cb

OGTT_longitudinal_nonabx
```

```{r ITTs Non-ABX Longitudinal Absolute, fig.width = 5}
NonABX_ITT_data <- ITT_long %>% 
  filter(ABX == "Non_ABX")

ITT_longitudinal_nonabx <- ggplot(NonABX_ITT_data, 
              aes(x = Time_min, y = Blood_glucose, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs Longitudinally \n in Non-ABX Mice", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Day") +
  theme_bw() + cb

ITT_longitudinal_nonabx

```

```{r OGTTs ABX Longitudinal Absolute, fig.width = 5}
ABX_OGTT_data <- OGTT_long %>% 
  filter(ABX == "ABX")

OGTT_longitudinal_abx <- ggplot(ABX_OGTT_data, 
              aes(x = Time_min, y = Blood_glucose, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs Longitudinally \n in ABX Mice", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Day") +
  theme_bw() + cb

OGTT_longitudinal_abx

```

```{r ITTs ABX Longitudinal Absolute, fig.width = 5}
ABX_ITT_data <- ITT_long %>% 
  filter(ABX == "ABX")

ITT_longitudinal_abx <- ggplot(ABX_ITT_data, 
              aes(x = Time_min, y = Blood_glucose, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs Longitudinally \n in ABX Mice", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Day") +
  theme_bw() + cb

ITT_longitudinal_abx

```

### AUC
```{r OGTTs Non-ABX Longitudinal AUC}
AUC_bar_graph_NonABX_OGTT_longitud <- 
        AUC_summary_stats_OGTT %>% 
        filter(ABX == "Non_ABX") %>% # filtering to just ABX 
            ggplot(aes(x = Day, y = mean_AUC, fill = Day)) +
            geom_bar(stat = "identity", position = "dodge") +
            facet_wrap(~ Hormone) + # facet wrapping by hormone group
            fb + # adding colors
            geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                          position = position_dodge(0.9), width = 0.25) + 
            labs(
              title = "OGTT AUCs in Non-ABX mice",
              x = "Hormone and \nDay",
              y = "Blood Glucose AUC \n (mg/dl/120 min)"
            ) +
            theme_bw() + 
            theme(
              legend.position = "none",
              plot.title = element_text(hjust = 0.5) # Center the title
            )

AUC_bar_graph_NonABX_OGTT_longitud
```

Are any of these differences statistically significant? Since this is longitudinal changes, I can run paired t-tests.

1. PGH Non ABX Baseline to Endpoint OGTT:
```{r Stats testing 3a}

# filter data
ttest_data_3a <- OGTTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "PGH") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_3a <- ttest_data_3a %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_3a <- t.test(AUC ~ Day, data = ttest_data_3a, paired = TRUE) 

analyze_ttest(ttest_result_3a)

```

2. PL Non ABX Baseline to Endpoint OGTT:
```{r Stats testing 3b}

# filter data
ttest_data_3b <- OGTTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "PL") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_3b <- ttest_data_3b %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_3b <- t.test(AUC ~ Day, data = ttest_data_3b, paired = TRUE) 

analyze_ttest(ttest_result_3b)

```

3. Saline Non ABX Baseline to Endpoint OGTT:
```{r Stats testing 3c}

# filter data
ttest_data_3c <- OGTTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "Saline") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_3c <- ttest_data_3c %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_3c <- t.test(AUC ~ Day, data = ttest_data_3c, paired = TRUE) 

analyze_ttest(ttest_result_3c)

```

***

```{r ITTs Non-ABX Longitudinal AUC}
AUC_bar_graph_NonABX_ITT_longitud <- 
        AUC_summary_stats_ITT %>% 
        filter(ABX == "Non_ABX") %>% # filtering to just ABX 
            ggplot(aes(x = Day, y = mean_AUC, fill = Day)) +
            geom_bar(stat = "identity", position = "dodge") +
            facet_wrap(~ Hormone) + # facet wrapping by hormone group
            fb + # adding colors
            geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                          position = position_dodge(0.9), width = 0.25) + 
            labs(
              title = "ITT AUCs in Non-ABX mice",
              x = "Hormone and \nDay",
              y = "Blood Glucose AUC \n (mg/dl/120 min)"
            ) +
            theme_bw() + 
            theme(
              legend.position = "none",
              plot.title = element_text(hjust = 0.5) # Center the title
            )

AUC_bar_graph_NonABX_ITT_longitud
```

Are any of these differences statistically significant? Not that while for the OGTTs, I could run paired t-tests, since some ITTs failed, I can only run unpaired t-tests.

1. PGH Non ABX Baseline to Endpoint ITT:
```{r Stats testing 4a}
# filter data
ttest_data_4a <- ITTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "PGH") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_4a <- t.test(AUC ~ Day, data = ttest_data_4a, paired = F) 

analyze_ttest(ttest_result_4a)
```

2. PL Non ABX Baseline to Endpoint ITT:
```{r Stats testing 4b}
# filter data
ttest_data_4b <- ITTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "PL") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_4b <- t.test(AUC ~ Day, data = ttest_data_4b, paired = F) 

analyze_ttest(ttest_result_4b)
```

3. Saline Non ABX Baseline to Endpoint ITT:
```{r Stats testing 4c}
# filter data
ttest_data_4c <- ITTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone == "Saline") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_4c <- t.test(AUC ~ Day, data = ttest_data_4c, paired = F) 

analyze_ttest(ttest_result_4c)
```

***

```{r OGTTs ABX Longitudinal AUC}
AUC_bar_graph_ABX_OGTT_longitud <- 
        AUC_summary_stats_OGTT %>% 
        filter(ABX == "ABX") %>% # filtering to just ABX 
            ggplot(aes(x = Day, y = mean_AUC, fill = Day)) +
            geom_bar(stat = "identity", position = "dodge") +
            facet_wrap(~ Hormone) + # facet wrapping by hormone group
            fb + # adding colors
            geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                          position = position_dodge(0.9), width = 0.25) + 
            labs(
              title = "OGTT AUCs in ABX mice",
              x = "Hormone and \nDay",
              y = "Blood Glucose AUC \n (mg/dl/120 min)"
            ) +
            theme_bw() + 
            theme(
              legend.position = "none",
              plot.title = element_text(hjust = 0.5) # Center the title
            )

AUC_bar_graph_ABX_OGTT_longitud

```

4. PGH ABX Baseline to Endpoint OGTT:
```{r Stats testing 5a}
# filter data
ttest_data_5a <- OGTTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "PGH") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_5a <- ttest_data_5a %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_5a <- t.test(AUC ~ Day, data = ttest_data_5a, paired = TRUE) 

analyze_ttest(ttest_result_5a)
```

5. PL ABX Baseline to Endpoint OGTT:
```{r Stats testing 5b}
# filter data
ttest_data_5b <- OGTTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "PL") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_5b <- ttest_data_5b %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_5b <- t.test(AUC ~ Day, data = ttest_data_5b, paired = TRUE) 

analyze_ttest(ttest_result_5b)
```

6. Saline ABX Baseline to Endpoint OGTT:
```{r Stats testing 5c}
# filter data
ttest_data_5c <- OGTTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "Saline") # filtering data 

# Fixing the order to do a paired t-test
ttest_data_5c <- ttest_data_5c %>%
  arrange(Mouse, Day)

# PAIRED t-test -- just have to make sure it's in order
ttest_result_5c <- t.test(AUC ~ Day, data = ttest_data_5c, paired = TRUE) 

analyze_ttest(ttest_result_5c)
```

*** 

```{r ITTs ABX longitudinal AUC}
AUC_bar_graph_ABX_ITT_longitud <- 
        AUC_summary_stats_ITT %>% 
        filter(ABX == "ABX") %>% # filtering to just ABX 
            ggplot(aes(x = Day, y = mean_AUC, fill = Day)) +
            geom_bar(stat = "identity", position = "dodge") +
            facet_wrap(~ Hormone) + # facet wrapping by hormone group
            fb + # adding colors
            geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                          position = position_dodge(0.9), width = 0.25) + 
            labs(
              title = "ITT AUCs in ABX mice",
              x = "Hormone and \nDay",
              y = "Blood Glucose AUC \n (mg/dl/120 min)"
            ) +
            theme_bw() + 
            theme(
              legend.position = "none",
              plot.title = element_text(hjust = 0.5) # Center the title
            )

AUC_bar_graph_ABX_ITT_longitud
```

4. PGH ABX Baseline to Endpoint ITT:
```{r Stats testing 6a}
# filter data
ttest_data_6a <- ITTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "PGH") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_6a <- t.test(AUC ~ Day, data = ttest_data_6a, paired = F) 

analyze_ttest(ttest_result_6a)
```

5. PL ABX Baseline to Endpoint ITT:
```{r Stats testing 6b}
# filter data
ttest_data_6b <- ITTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "PL") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_6b <- t.test(AUC ~ Day, data = ttest_data_6b, paired = F) 

analyze_ttest(ttest_result_6b)
```

6. Saline ABX Baseline to Endpoint ITT:
```{r Stats testing 6c}
# filter data
ttest_data_6c <- ITTs_wide %>% 
     filter(ABX == "ABX" & Hormone == "Saline") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_6c <- t.test(AUC ~ Day, data = ttest_data_6c, paired = F) 

analyze_ttest(ttest_result_6c)
```

### Percent Change Response Over Time

```{r OGTTs Non-ABX Longitudinal Percentage, fig.width = 5}
# Filtering to just non abx mice
NonABX_OGTT_percentage <- OGTT_percentage %>% 
  filter(ABX == "Non_ABX")

OGTT_longitudinal_nonabx_perc <- ggplot(NonABX_OGTT_percentage, 
              aes(x = Time_min, y = BG_percent_of_baseline, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs Longitudinally \n in Non-ABX Mice (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Day") +
  theme_bw() + cb

OGTT_longitudinal_nonabx_perc
```
  
```{r ITTs Non-ABX Longitudinal Percentage, fig.width = 5}
NonABX_ITT_percentage <- ITT_percentage %>% 
  filter(ABX == "Non_ABX")

ITT_longitudinal_nonabx_perc <- ggplot(NonABX_ITT_percentage, 
              aes(x = Time_min, y = BG_percent_of_baseline, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs Longitudinally \n in Non-ABX Mice (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Day") +
  theme_bw() + cb

ITT_longitudinal_nonabx_perc
```

```{r OGTTs ABX Longitudinal Percentage, fig.width = 5}
ABX_OGTT_percentage <- OGTT_percentage %>% 
  filter(ABX == "ABX")

OGTT_longitudinal_abx_perc <- ggplot(ABX_OGTT_percentage, 
              aes(x = Time_min, y = BG_percent_of_baseline, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs Longitudinally \n in ABX Mice (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Day") +
  theme_bw() + cb

OGTT_longitudinal_abx_perc
```

```{r ITTs ABX Longitudinal Percentage, fig.width = 5}
ABX_ITT_percentage <- ITT_percentage %>% 
  filter(ABX == "ABX")

ITT_longitudinal_abx_perc <- ggplot(ABX_ITT_percentage, 
              aes(x = Time_min, y = BG_percent_of_baseline, color = Day, group = Day)) + # grouping by day
  stat_summary(fun = "mean", geom = "point") +
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrap by hormone
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs Longitudinally \n in ABX Mice (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Day") +
  theme_bw() + cb

ITT_longitudinal_abx_perc
```

### Fasting BG
  
In each of the six groups, I want to see if there is a longitudinal change in fasting BG. 

- Similar to what I did for baseline, I can combine the OGTT and ITT fasting BG values and run LMEs with mouse ID as a random effect (i.e., 4 values / mouse, 2 at each time point) to increase my power to detect longitudinal changes. 

- Note that particularly in the ABX mice, I predict that fasting BG may decrease in all groups, including saline, because even though they are on ABX at both timepoints, there may be an additive effect of longer-term ABX exposure on BG levels.

- I'm actually not sure by looking at the figures that any will be significant, but we'll see! 

  1. PGH Non-ABX Baseline to Endpoint:
```{r PGH Non-ABX Baseline to Endpoint Fasting BG Stats}
# One issue we're going to have is that we want to run the LME by baseline / endpoint, NOT day. 
# So need to add this as a column. Here's the wrangling for that:
Fasting_BG <- Fasting_BG %>% 
  mutate(Time_point = if_else(Day %in% c("D-2", "D-1"), 
                              "Baseline",
                              "Endpoint"))

# Filter data
Fasting_BG_PGH_NonABX <- Fasting_BG %>% 
  filter(Hormone == "PGH" | ABX == "Non_ABX")

# Running the LME
fasting_bg_pgh_nonabx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), data = Fasting_BG_PGH_NonABX)
fasting_bg_pgh_nonabx_longitud_lme_model_summary <- summary(fasting_bg_pgh_nonabx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_pgh_nonabx_longitud_lme_model_summary)
```
  
  2. PL Non-ABX Baseline to Endpoint:
```{r PL Non-ABX Baseline to Endpoint Fasting BG Stats}
# Filter data
Fasting_BG_PL_NonABX <- Fasting_BG %>% 
  filter(Hormone == "PL" | ABX == "Non_ABX")

# Running the LME
fasting_bg_pl_nonabx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), data = Fasting_BG_PL_NonABX)
fasting_bg_pl_nonabx_longitud_lme_model_summary <- summary(fasting_bg_pl_nonabx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_pl_nonabx_longitud_lme_model_summary)
```
  
  3. Saline Non-ABX Baseline to Endpoint:
```{r Saline Non-ABX Baseline to Endpoint Fasting BG Stats}
# Filter data
Fasting_BG_Saline_NonABX <- Fasting_BG %>% 
  filter(Hormone == "Saline" | ABX == "Non_ABX")

# Running the LME
fasting_bg_saline_nonabx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), 
                                                    data = Fasting_BG_Saline_NonABX)
fasting_bg_saline_nonabx_longitud_lme_model_summary <- summary(fasting_bg_saline_nonabx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_saline_nonabx_longitud_lme_model_summary)
```
  
  4. PGH ABX Baseline to Endpoint:
```{r PGH ABX Baseline to Endpoint Fasting BG Stats}
# Filter data
Fasting_BG_PGH_ABX <- Fasting_BG %>% 
  filter(Hormone == "PGH" | ABX == "ABX")

# Running the LME
fasting_bg_pgh_abx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), data = Fasting_BG_PGH_ABX)
fasting_bg_pgh_abx_longitud_lme_model_summary <- summary(fasting_bg_pgh_abx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_pgh_abx_longitud_lme_model_summary)
```
  
  5. PL ABX Baseline to Endpoint:
```{r PL ABX Baseline to Endpoint Fasting BG Stats}
# Filter data
Fasting_BG_PL_ABX <- Fasting_BG %>% 
  filter(Hormone == "PL" | ABX == "ABX")

# Running the LME
fasting_bg_pl_abx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), data = Fasting_BG_PL_ABX)
fasting_bg_pl_abx_longitud_lme_model_summary <- summary(fasting_bg_pl_abx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_pl_abx_longitud_lme_model_summary)
```
  
  6. Saline ABX Baseline to Endpoint:
```{r Saline ABX Baseline to Endpoint Fasting BG Stats}
# Filter data
Fasting_BG_Saline_ABX <- Fasting_BG %>% 
  filter(Hormone == "Saline" | ABX == "ABX")

# Running the LME
fasting_bg_saline_abx_longitud_lme_model <- lmer(Blood_glucose ~ Time_point + (1 | Mouse), 
                                                    data = Fasting_BG_Saline_ABX)
fasting_bg_saline_abx_longitud_lme_model_summary <- summary(fasting_bg_saline_abx_longitud_lme_model)

# running the function!
analyze_lme(fasting_bg_saline_abx_longitud_lme_model_summary)
```
  
So *NO* groups saw significant changes in fasting BG from baseline to endpoint. Despite some clear changes in tolerance test responses. That's interesting! 

***
## 2.a.iii. Endpoint OGTTs and ITTs in each hormone group vs saline 

### Absolute Responses
  
Endpoint OGTTs in each hormone group:

*We can include all 3 hormone groups together, or to make seeing patterns visually easier, separate each hormone to just be vs saline*
```{r Endpoint OGTTs Hormone Comparisons Absolute, fig.width = 5}
# making pretty colors
c3 <- scale_color_manual(
  values = c(
    "PGH" = "darkturquoise",
    "PL" = "deeppink",
    "Saline" = "darkviolet"
  )
)

f3 <- scale_fill_manual(
  values = c(
    "PGH" = "darkturquoise",
    "PL" = "deeppink",
    "Saline" = "darkviolet"
  )
)

# Filtering
D6_OGTT_data <- OGTT_long %>% 
  filter(Day == "D6")

# ALL HORMONES
Endpoint_OGTT_by_hormone_all <- ggplot(D6_OGTT_data, 
                       aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_all 

# PGH VS SALINE
Endpoint_OGTT_by_hormone_pghvssaline <- D6_OGTT_data %>% 
  filter(Hormone != "PL") %>% 
  ggplot(aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_pghvssaline

# PL VS SALINE
Endpoint_OGTT_by_hormone_plvssaline <- D6_OGTT_data %>% 
  filter(Hormone != "PGH") %>% 
  ggplot(aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_plvssaline
```

Endpoint ITTs in each hormone group:
```{r Endpoint ITTs Hormone Comparisons Absolute, fig.width = 5}
# Filtering
D7_ITT_data <- ITT_long %>% 
  filter(Day == "D7")

# ALL HORMONES
Endpoint_ITT_by_hormone_all <- ggplot(D7_ITT_data, 
                       aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_all 

# PGH VS SALINE
Endpoint_ITT_by_hormone_pghvssaline <- D7_ITT_data %>% 
  filter(Hormone != "PL") %>% 
  ggplot(aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_pghvssaline

# PL VS SALINE
Endpoint_ITT_by_hormone_plvssaline <- D7_ITT_data %>% 
  filter(Hormone != "PGH") %>% 
  ggplot(aes(x = Time_min, y = Blood_glucose, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_plvssaline
```
  
### AUC
  
```{r Endpoint OGTT by Hormone Non-ABX AUC}
AUC_bar_graph_endpoints_NonABX_OGTT <- AUC_summary_stats_OGTT %>% 
        filter(Day == "D6", ABX == "Non_ABX") %>% 
          ggplot(aes(x = Hormone, y = mean_AUC, fill = Hormone)) +
        geom_bar(stat = "identity", position = "dodge") +
        f3 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Endpoint OGTT AUCs Non-ABX Mice",
          x = "Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_NonABX_OGTT
```

```{r Endpoint ITT by Hormone Non-ABX AUC}
AUC_bar_graph_endpoints_NonABX_ITT <- AUC_summary_stats_ITT %>% 
        filter(Day == "D7", ABX == "Non_ABX") %>% 
          ggplot(aes(x = Hormone, y = mean_AUC, fill = Hormone)) +
        geom_bar(stat = "identity", position = "dodge") +
        f3 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Endpoint ITT AUCs Non-ABX Mice",
          x = "Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_NonABX_ITT
```

```{r Endpoint OGTT by Hormone ABX AUC}
AUC_bar_graph_endpoints_ABX_OGTT <- AUC_summary_stats_OGTT %>% 
        filter(Day == "D6", ABX == "ABX") %>% 
          ggplot(aes(x = Hormone, y = mean_AUC, fill = Hormone)) +
        geom_bar(stat = "identity", position = "dodge") +
        f3 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Endpoint OGTT AUCs ABX Mice",
          x = "Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_ABX_OGTT
```

```{r Endpoint ITT by Hormone ABX AUC}
AUC_bar_graph_endpoints_ABX_ITT <- AUC_summary_stats_ITT %>% 
        filter(Day == "D7", ABX == "ABX") %>% 
          ggplot(aes(x = Hormone, y = mean_AUC, fill = Hormone)) +
        geom_bar(stat = "identity", position = "dodge") +
        f3 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        labs(
          title = "Endpoint ITT AUCs ABX Mice",
          x = "Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_ABX_ITT
```

Now we can test the stats for each of these AUC pairings.

**Non-ABX**

_**PGH vs Saline**_
  
  _OGTT_
```{r Stats 7a1}
# filter data
ttest_data_7a1 <- OGTTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone != "PL" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_7a1 <- t.test(AUC ~ Hormone, data = ttest_data_7a1, paired = F) 

analyze_ttest(ttest_result_7a1)
```

  _ITT_
```{r Stats 7a2}
# filter data
ttest_data_7a2 <- ITTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone != "PL" & Day == "D7") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_7a2 <- t.test(AUC ~ Hormone, data = ttest_data_7a2, paired = F) 

analyze_ttest(ttest_result_7a2)
```
    
_**PL vs Saline**_
  
  _OGTT_
```{r Stats 7b1}
# filter data
ttest_data_7b1 <- OGTTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone != "PGH" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_7b1 <- t.test(AUC ~ Hormone, data = ttest_data_7b1, paired = F) 

analyze_ttest(ttest_result_7b1)
```

  _ITT_
```{r Stats 7b2}
# filter data
ttest_data_7b2 <- ITTs_wide %>% 
     filter(ABX == "Non_ABX" & Hormone != "PGH" & Day == "D7") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_7b2 <- t.test(AUC ~ Hormone, data = ttest_data_7b2, paired = F) 

analyze_ttest(ttest_result_7b2)
```

***

**ABX**

_**PGH vs Saline**_
  
  _OGTT_
```{r Stats 8a1}
# filter data
ttest_data_8a1 <- OGTTs_wide %>% 
     filter(ABX == "ABX" & Hormone != "PL" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_8a1 <- t.test(AUC ~ Hormone, data = ttest_data_8a1, paired = F) 

analyze_ttest(ttest_result_8a1)
```

  _ITT_
```{r Stats 8a2}
# filter data
ttest_data_8a2 <- ITTs_wide %>% 
     filter(ABX == "ABX" & Hormone != "PL" & Day == "D7") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_8a2 <- t.test(AUC ~ Hormone, data = ttest_data_8a2, paired = F) 

analyze_ttest(ttest_result_8a2)
```
      
_**PL vs Saline**_
  
  _OGTT_
```{r Stats 8b1}
# filter data
ttest_data_8b1 <- OGTTs_wide %>% 
     filter(ABX == "ABX" & Hormone != "PGH" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_8b1 <- t.test(AUC ~ Hormone, data = ttest_data_8b1, paired = F) 

analyze_ttest(ttest_result_8b1)
```

  _ITT_
```{r Stats 8b2}
# filter data
ttest_data_8b2 <- ITTs_wide %>% 
     filter(ABX == "ABX" & Hormone != "PGH" & Day == "D7") # filtering data 

# UNPAIRED t-test -- just have to make sure it's in order
ttest_result_8b2 <- t.test(AUC ~ Hormone, data = ttest_data_8b2, paired = F) 

analyze_ttest(ttest_result_8b2)
```    
***      
### Percent Change Responses

```{r Endpoint OGTTs Hormone Comparisons Percentage, fig.width = 5}
# ALL HORMONES
Endpoint_OGTT_by_hormone_all_perc <- OGTT_percentage %>% 
  filter(Day == "D6") %>% ggplot(aes(x = Time_min, y = BG_percent_of_baseline, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_all_perc


# PGH VS SALINE
Endpoint_OGTT_by_hormone_pghvssaline_perc <- OGTT_percentage %>% 
  filter(Day == "D6" & Hormone != "PL") %>% ggplot(aes(x = Time_min, 
                                                       y = BG_percent_of_baseline, 
                                                       color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_pghvssaline_perc

# PL VS SALINE
Endpoint_OGTT_by_hormone_plvssaline_perc <- OGTT_percentage %>% 
  filter(Day == "D6" & Hormone != "PGH") %>% ggplot(aes(x = Time_min, 
                                                       y = BG_percent_of_baseline, 
                                                       color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_OGTT_by_hormone_plvssaline_perc
```
  
```{r Endpoint ITTs Hormone Comparisons Percentage, fig.width = 5}
# ALL HORMONES
Endpoint_ITT_by_hormone_all_perc <- ITT_percentage %>% 
  filter(Day == "D7") %>% ggplot(aes(x = Time_min, y = BG_percent_of_baseline, color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_all_perc

# PGH VS SALINE
Endpoint_ITT_by_hormone_pghvssaline_perc <- ITT_percentage %>% 
  filter(Day == "D7" & Hormone != "PL") %>% ggplot(aes(x = Time_min, 
                                                       y = BG_percent_of_baseline, 
                                                       color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_pghvssaline_perc

# PL VS SALINE
Endpoint_ITT_by_hormone_plvssaline_perc <- ITT_percentage %>% 
  filter(Day == "D7" & Hormone != "PGH") %>% ggplot(aes(x = Time_min, 
                                                       y = BG_percent_of_baseline, 
                                                       color = Hormone, group = Hormone)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ ABX) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D6) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() +c3
Endpoint_ITT_by_hormone_plvssaline_perc
```

### Fasting BG

Now let's see if there are statistically significant differences between the hormone groups in endpoint fasting BG values.

- Similar to what I did for the prior fasting BG analyses, I will combine the OGTT and ITT fasting BG values and run LMEs with mouse ID as a random effect (i.e., 2 values / mouse) to increase my power to detect group differences. 

**Non-ABX**

_**PGH vs Saline**_
```{r Non-ABX PGH vs Saline Fasting BG Stats}
# Filter data
Fasting_BG_PGHvsSaline_NonABX <- Fasting_BG %>% 
  filter(Hormone != "PL" & ABX == "Non_ABX" & Time_point == "Endpoint")

# Running the LME
fasting_bg_pghvssaline_nonabx_lme_model <- lmer(Blood_glucose ~ Hormone + (1 | Mouse), data = Fasting_BG_PGHvsSaline_NonABX)
fasting_bg_pghvssaline_nonabx_lme_model_summary <- summary(fasting_bg_pghvssaline_nonabx_lme_model)

# running the function!
analyze_lme(fasting_bg_pghvssaline_nonabx_lme_model_summary)
```

_**PL vs Saline**_
```{r Non-ABX PL vs Saline Fasting BG Stats}
# Filter data
Fasting_BG_PLvsSaline_NonABX <- Fasting_BG %>% 
  filter(Hormone != "PGH" & ABX == "Non_ABX" & Time_point == "Endpoint")

# Running the LME
fasting_bg_plvssaline_nonabx_lme_model <- lmer(Blood_glucose ~ Hormone + (1 | Mouse), data = Fasting_BG_PLvsSaline_NonABX)
fasting_bg_plvssaline_nonabx_lme_model_summary <- summary(fasting_bg_plvssaline_nonabx_lme_model)

# running the function!
analyze_lme(fasting_bg_plvssaline_nonabx_lme_model_summary)
```

**ABX**

_**PGH vs Saline**_
```{r ABX PGH vs Saline Fasting BG Stats}
# Filter data
Fasting_BG_PGHvsSaline_ABX <- Fasting_BG %>% 
  filter(Hormone != "PL" & ABX == "ABX" & Time_point == "Endpoint")

# Running the LME
fasting_bg_pghvssaline_abx_lme_model <- lmer(Blood_glucose ~ Hormone + (1 | Mouse), data = Fasting_BG_PGHvsSaline_ABX)
fasting_bg_pghvssaline_abx_lme_model_summary <- summary(fasting_bg_pghvssaline_abx_lme_model)

# running the function!
analyze_lme(fasting_bg_pghvssaline_abx_lme_model_summary)
```

_**PL vs Saline**_
```{r ABX PL vs Saline Fasting BG Stats}
# Filter data
Fasting_BG_PLvsSaline_ABX <- Fasting_BG %>% 
  filter(Hormone != "PGH" & ABX == "ABX" & Time_point == "Endpoint")

# Running the LME
fasting_bg_plvssaline_abx_lme_model <- lmer(Blood_glucose ~ Hormone + (1 | Mouse), data = Fasting_BG_PLvsSaline_ABX)
fasting_bg_plvssaline_abx_lme_model_summary <- summary(fasting_bg_plvssaline_abx_lme_model)

# running the function!
analyze_lme(fasting_bg_plvssaline_abx_lme_model_summary)
```

## 2.a.iv. Endpoint OGTTs and ITTs in each hormone group abx vs non-abx

### Absolute Responses
  
```{r OGTT Endpoint ABX vs Non ABX Absolute, fig.width = 5}

Endpoint_OGTT_by_abx <- ggplot(D6_OGTT_data, 
                       aes(x = Time_min, y = Blood_glucose, color = ABX, group = ABX)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() + c2
Endpoint_OGTT_by_abx

```

```{r ITT Endpoint ABX vs Non ABX Absolute, fig.width = 5}
Endpoint_ITT_by_abx <- ggplot(D7_ITT_data, 
                       aes(x = Time_min, y = Blood_glucose, color = ABX, group = ABX)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7)", 
       x = "Time (min)", 
       y = "Glucose (mg/dL)", 
       color = "Treatment Group") +
  theme_bw() + c2
Endpoint_ITT_by_abx
```

### AUC

```{r AUC Endpoint OGTT ABX vs Non ABX per Hormone}
AUC_bar_graph_endpoints_OGTT_abxcomparisons <- AUC_summary_stats_OGTT %>% 
        filter(Day == "D6") %>% 
          ggplot(aes(x = ABX, y = mean_AUC, fill = ABX)) +
        geom_bar(stat = "identity", position = "dodge") +
        f2 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        facet_wrap("Hormone") +
        labs(
          title = "Endpoint OGTT AUCs \n Non-ABX vs ABX Mice",
          x = "ABX Status and Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_OGTT_abxcomparisons
```

```{r AUC Endpoint ITT ABX vs Non ABX per Hormone}
AUC_bar_graph_endpoints_ITT_abxcomparisons <- AUC_summary_stats_ITT %>% 
        filter(Day == "D7") %>% 
          ggplot(aes(x = ABX, y = mean_AUC, fill = ABX)) +
        geom_bar(stat = "identity", position = "dodge") +
        f2 + theme_bw() +
        geom_errorbar(aes(ymin = ymin, ymax = ymax), 
                      position = position_dodge(0.9), width = 0.25) + 
        facet_wrap("Hormone") +
        labs(
          title = "Endpoint ITT AUCs \n Non-ABX vs ABX Mice",
          x = "ABX Status and Hormone",
          y = "Blood Glucose AUC \n (mg/dl/120 min)") +
        theme(
          legend.position = "none",
          plot.title = element_text(hjust = 0.5) # Center the title
        )
AUC_bar_graph_endpoints_ITT_abxcomparisons
```

Now we will test the significance for each antibiotic group pairing. I'm guessing these may all be significant. 

_**PGH ABX vs Non ABX**_
  
  _OGTT_
```{r Stats 9a}
# filter data
ttest_data_9a <- OGTTs_wide %>% 
     filter(Hormone == "PGH" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_9a <- t.test(AUC ~ ABX, data = ttest_data_9a, paired = F) 

analyze_ttest(ttest_result_9a)
```

  _ITT_
```{r Stast 9b}
# filter data
ttest_data_9b <- ITTs_wide %>% 
     filter(Hormone == "PGH" & Day == "D7") # filtering data 

# UNPAIRED t-test
ttest_result_9b <- t.test(AUC ~ ABX, data = ttest_data_9b, paired = F) 

analyze_ttest(ttest_result_9b)
```
  
_**PL ABX vs Non ABX**_
  
  _OGTT_
```{r Stast 10a}
# filter data
ttest_data_10a <- OGTTs_wide %>% 
     filter(Hormone == "PL" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_10a <- t.test(AUC ~ ABX, data = ttest_data_10a, paired = F) 

analyze_ttest(ttest_result_10a)
```
  
  _ITT_
```{r Stats 10b}
ttest_data_10b <- ITTs_wide %>% 
     filter(Hormone == "PL" & Day == "D7") # filtering data 

# UNPAIRED t-test
ttest_result_10b <- t.test(AUC ~ ABX, data = ttest_data_10b, paired = F) 

analyze_ttest(ttest_result_10b)
```
  
_**Saline ABX vs Non ABX**_
  
  _OGTT_
```{r Stats 11a}
# filter data
ttest_data_11a <- OGTTs_wide %>% 
     filter(Hormone == "Saline" & Day == "D6") # filtering data 

# UNPAIRED t-test
ttest_result_11a <- t.test(AUC ~ ABX, data = ttest_data_11a, paired = F) 

analyze_ttest(ttest_result_11a)
```
  
  _ITT_
```{r Stats 11b}
# filter data
ttest_data_11b <- ITTs_wide %>% 
     filter(Hormone == "Saline" & Day == "D7") # filtering data 

# UNPAIRED t-test
ttest_result_11b <- t.test(AUC ~ ABX, data = ttest_data_11b, paired = F) 

analyze_ttest(ttest_result_11b)
```

As expected, for all 3 hormone groups, there is a signif dif in AUC for both OGTT and ITT between mice with and without a normal gut microbiome. 

### Percent Change Responses

```{r OGTT Endpoint ABX vs Non ABX Percentage, fig.width = 5}
Endpoint_OGTT_by_abx_perc <- OGTT_percentage %>% 
  filter(Day == "D6") %>% ggplot(
                       aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = ABX)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "OGTTs at Endpoint (D6) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() + c2
Endpoint_OGTT_by_abx_perc
```

```{r ITT Endpoint ABX vs Non ABX Percentage, fig.width = 5}
Endpoint_ITT_by_abx_perc <- ITT_percentage %>% 
  filter(Day == "D7") %>% ggplot(
                       aes(x = Time_min, y = BG_percent_of_baseline, color = ABX, group = ABX)) + 
  stat_summary(fun = "mean", geom = "point", size = 2) + # means by hormone group
  stat_summary(fun = "mean", geom = "line") + 
  stat_summary(geom = "linerange") +
  facet_wrap(~ Hormone) + # facet wrapping by ABX group
  scale_x_continuous(breaks = c(0, 15, 30, 60, 90, 120)) + 
  labs(title = "ITTs at Endpoint (D7) (%)", 
       x = "Time (min)", 
       y = "Blood Glucose (% Change)", 
       color = "Treatment Group") +
  theme_bw() + c2
Endpoint_ITT_by_abx_perc
```
Basically, it looks like the metabolic differences between ABX and Non-ABX groups are largely driven by changes in fasting BG, so converting to % change makes them go away. But the metabolic differences between hormone groups are NOT driven by fasting BG, so they largely remain or sometimes magnify upon converting to % change. 

### Fasting BG

Now let's see if there are statistically significant differences between the abx groups for each hormone in endpoint fasting BG values. Based on what we've seen so far, we can expect them all to be significant. 

- Similar to what I did for the prior fasting BG analyses, I will combine the OGTT and ITT fasting BG values and run LMEs with mouse ID as a random effect (i.e., 2 values / mouse) to increase my power to detect group differences. 

_**PGH ABX vs Non ABX**_
```{r PGH ABX vs Non ABX Fasting BG Stats}
# Filter data
Fasting_BG_PGH_ABX_comparisons <- Fasting_BG %>% 
  filter(Hormone == "PGH" & Time_point == "Endpoint")

# Running the LME
fasting_bg_pgh_abx_comparisons_lme_model <- lmer(Blood_glucose ~ ABX + (1 | Mouse), data = Fasting_BG_PGH_ABX_comparisons)
fasting_bg_pgh_abx_comparisons_lme_model_summary <- summary(fasting_bg_pgh_abx_comparisons_lme_model)

# running the function!
analyze_lme(fasting_bg_pgh_abx_comparisons_lme_model_summary)
```

_**PL ABX vs Non ABX**_
```{r PL ABX vs Non ABX Fasting BG Stats}
# Filter data
Fasting_BG_PL_ABX_comparisons <- Fasting_BG %>% 
  filter(Hormone == "PL" & Time_point == "Endpoint")

# Running the LME
fasting_bg_pl_abx_comparisons_lme_model <- lmer(Blood_glucose ~ ABX + (1 | Mouse), data = Fasting_BG_PL_ABX_comparisons)
fasting_bg_pl_abx_comparisons_lme_model_summary <- summary(fasting_bg_pl_abx_comparisons_lme_model)

# running the function!
analyze_lme(fasting_bg_pl_abx_comparisons_lme_model_summary)
```

_**Saline ABX vs Non ABX**_
```{r Saline ABX vs Non ABX Fasting BG Stats}
Fasting_BG_Saline_ABX_comparisons <- Fasting_BG %>% 
  filter(Hormone == "Saline" & Time_point == "Endpoint")

# Running the LME
fasting_bg_saline_abx_comparisons_lme_model <- lmer(Blood_glucose ~ ABX + (1 | Mouse), 
                                                    data = Fasting_BG_Saline_ABX_comparisons)
fasting_bg_saline_abx_comparisons_lme_model_summary <- summary(fasting_bg_saline_abx_comparisons_lme_model)

# running the function!
analyze_lme(fasting_bg_saline_abx_comparisons_lme_model_summary)
```

